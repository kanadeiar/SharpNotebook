# Null-типы

В языке C# система обозначений в форме суффикса ? представляет собой сокращение для создания экземпляра обобщенного типа структуры System.Nullable<T>.

Для CLR разработаны специальные null-совместимые значимые типы. Основа - класс System.Nullable<T>. Этот класс реализует значимый тип, который может принимать null.

Так как Nullable<T> также относится к значимым типам, его экземпляры достаточно производительны, поскольку экземпляры могут размещаться в стеке, а их размер совпадает с размером исходного типа, к которому приплюсован размер поля типа bool.

Пример:

```csharp
int? x1 = 5;
int? y1 = null;
Nullable<int> x2 = 5;
Nullable<int> y2 = null;
```

Можно выполнять преобразования, а также приведение null-совместимых экземпляров к другим типам.

C# позволяет применять операторы к экземплярам null-совместимых типов.

С помощью свойства HasValue или операции != null можно программно выяснять, действительно ли переменной, допускающей null, присвоено значение null.

## Ссылочные типы, допускающие значение null

Ссылочные типы, допускающие значение null, подчиняются множеству тех же самых правил, что и типы значений, допускающие null. Переменным ссылочных типов, не допускающих null, во время инициализации должны присваиваться отличающиеся от null значения, которые позже нельзя изменять на null. Переменные ссылочных типов, допускающих null, могут принимать значение null, но перед первым использованием им по-прежнему должны присваиваться какие-то значения.

Поддержка для ссылочных типов, допускающих null, управляется установкой контекста допустимости значения null.

Cсылочные типы, допускающие значение null, не имеют свойств HasValue и Value.

Пример:

```csharp
public class Sample
{
    public string? Name { get; set; } = null;
}
```

## Оператор объединения с null

В C# существует оператор объединения null-совместимых значений. Он обозначается двумя вопросами - ??. Если левый операнд не равен null, оператор возвращает его значение. В противном случае возвращается значение правого операнда. Основным преимуществом этого оператора является поддержка как ссылочных, так и null-совместимых значимых типов.

```csharp
int? val = 5;
int val2 = val ?? 4;
Func<String> f = () => SomeMethod() ?? "Untitled";
String s = SomeMethod1() ?? SomeMethod2() ?? "Untitled";
```

## Null-условная операция

В языке C# имеется маркер null-условной операции (знак вопроса, находящийся после типа переменной, но перед операцией доступа к члену), который позволяет упростить представленную ранее проверку на предмет null.

```csharp
Console.WriteLine($"You sent me {args?.Length} arguments.");
```

Если переменная args равна null, тогда обращение к свойству Length не приведет к ошибке во время выполнения.

## Операция присваивания с объединением null

В C# есть операция присваивания с объединением с null (? ?=), основанная на операции объединения с null. Эта операция выполняет присваивание левого операнда правому операнду, только если левый операнд равен null.

```csharp
int? nullablelnt = null;
nullablelnt ??= 12;
nullablelnt ??= 14;
```

## Поддержка null-типов в CLR

### Упаковка

При упаковке экземпляра Nullable<T> проверяется его равенство null и в случае положительного результата вместо упаковки возвращается null. В противном случае CLR упаковывает значение экземпляра.

В CLR упакованный значимый тип T распаковывается в T или в Nullable<T>. Если ссылка на упакованный значимый тип равна null и выполняется распаковка в тип Nullable<T>, CLR присваивает Nullable<T> значение null.

При вызове метода GetType для объекта типа Nullable<T> CLR возвращает тип T вместо Nullable<T>

CLR успешно выполняет приведение null-типа к интерфейсу, скрывая детали приведения типов.




