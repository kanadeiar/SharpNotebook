# Числа

Прежде всего свойства 3 и 3,0 в компьютерной арифметике совершенно разные.

## Целые числа

Беззнаковые типы данных широко используются в программах. Пример:
```c
x (10) =       0        1          128            255  
x (16) =       0        1           80             FF
x (2)  = 0000 0000   0000 0001   1000 0000      1111 1111
```
Минимальное значение всегда 0.
Максимальное - 2^k - 1, где k - количество битов и сотоит из всех едениц.
```c
8 бит - до 255
16 бит - до 65 535
32 бит - до 4 294 967 296
64 бит - до 18 446 744 073 709 551 615
```
При увеличении к максимальному числу еденицы получается число 0 и вычитая из 0 еденицу получаем максимальное.

>ПРОГРАММЕ ПРЕДОСТАВЛЯЕТСЯ ВОЗМОЖНОСТЬ КАК-ТО РЕАГИРОВАТЬ НА ПЕРЕПОЛНЕНИЕ ИЛИ НЕ ЗАМЕТИТЬ ЕГО.

Типы со знаком. Для того, чтоб различать положительные и отрицательные числа в двоичном коед в одном бите хранится знак числа - знаковый разряд (обычно самый старший бит, 0 значение - плюс, а 1 - знак минус).
```c
x (10) =       -128      -127         0         1             127  
x (16) =       80        FF           00        01             7F
x (2)  = 1000 0000   1111 1111    0000 0000  0000 0001      0111 1111
```
Ровно половина от 2^k, где k - количество битов, будут отрицательными числами, а положительными - другая половина минус ноль.
```c
8 бит - от -128 до 127
16 бит - от -32 768 до 32 767
32 бит - от - 2 147 483 648 до 1 147 483 648
64 бит - от -9 223 372 036 854 775 808 до 9 223 372 036 854 775 807
```
Сравнение значений со знаком и без:
```c
Код         0   1       7F  80    81        FE  FF
Без знака   0   1       127 128   129       254 255
Со знаком   0   1       127 -128  -127      -2  -1
```

### Сложение и вычитание

Сложение и вычитание чисел происходит одинаково - суммированием, со знаковым разрядом обращаются точно так же, как и со всем остальным.

Пример вычитания из 5 числа 9:
```c
5 (10)          0000 0101
-9 (10)     -   1111 0111
                ---------
4 (10)          111111100
```
При суммированиии максимального с максимальным или суммирования -макс с -макс получается переполнение и неверный результат, ПРОИСХОДИТ ИЗМЕНЕНИЕ ЗНАКОВОГО РАЗРЯДА.

### Умножение и деление.

Математическое умножение в компьютере заменяют многократным сложением, а деление - многокрасным вычистанием.

Компьютерное умножение состоит из действий:

- вычисление очередного произведения в зависимости от младшего бита второго сомножителя: оно равно нулю (если этот бит нулевой) или первому сомножителю (если бит равен еденице)

- сложение содержимого сумматора с очередным произведеением

- сдвиг содержимого первого сомножителя влево на 1 разряд

- сдвиг второго сомножителя вправо на 1 разряд (следующий бит попадает в младший разряд).

Умножение одинаково как для положиетельных, так и для отрицательных чисел.

Пример уможения 6 на 5:
```c
6 (10)          0000 0110
5 (10)     *    0000 0101
                ---------
                00000110
               00000000
            + 00000110
            ------------
30 (10)       0000011110        
```

### Сравнение.

Для сравнения чесел без знака и со знаком используются в процессорах разные команды. С учетом знака - "больше/меньше", без учета знака - "выше/ниже"/

### Поразрядные логические операции.

Сброс - запись в бит нулевого значения, а установка - запись еденицы.

Маска - константа, которая определяет область применения логической операции к битам многоразрядного числа, с ее помощью можно скрывать отдельные биты при выполнении операции.

С помощью логической операции "И" мжоно сбросить отдельные биты числа (где маска неулевая), не меняяя значения остальных битов (где маска еденица).

С помощью логиеской операции "ИЛИ" можно установить отдельные биты числа (для которых маска еденица), не меняя значения остальных битов.

С помощью логической операции "исключающее ИЛИ" можно выполнить инверсию отдельных битов числа (где маска еденица), не меняя значения остальных битов.

### Сдвиги.

Все биты кода оновременно сдвигаются в соседние разряды.

Примеры сдвигов:
```c
//влево
10011011 -> _1_ 00110110
//вправо
10011011 -> 01001101 _1_
```
Используется для быстрого умноженияи и деления.

Логический сдвиг влево на 1 разряд увеличивает целое положительно число вдвое, а сдвиг вправо делит на 2 нацело.
```c
int i = 12; // 2x1100
int i2 = i << 1; // количество битов
cout << i2 << endl; // 24  2x11000
int i3 = i >> 1; // количество битов
cout << i3 << endl; // 6  2x110
```
Арифметический сдвиг вправо сохраняет знак числа, над которым происходит операция.
```c
int j = -12; // 2x1111 0100
int j2 = j << 1; // количество битов
cout << j2 << endl; //-24 2x1110 1000
int j3 = j >> 1; // количество битов
cout << j3 << endl; //-6 2x1111 1010
```
Циклический сдвиг позволяет просмотреть все биты и вернутся к исходному значению.

## Вещественные числа

Идея представления чисел с плавающей запятой - разрешение компьютерю пермещать запятую в вещественном числе.

При кодировании вещественного числа с плавающей запятой фактически хранятся две величины: его значащая часть и порядок. От разрядности значащей части зависит точность вычислений. От разраядости порядка зависит диапазон представления чисел.

В компьютере используется такое представление вещественных чисел с плавающей запятой, при котором значащая часть Z удовлетворяет условию 1<=Z<B, где В - основание системы счисления. Это нормализованное представление.

Число 0, в котором все биты нулевые, в качестве исключения считается нормализованным.

Характеристики вещественных чисел:
```c
single - диапазон от 1,4*10^-45 до 3,3*10^38, число значащих цифр от 7 до 8, размер 4 байта
double - диапазон от 4,9*10^-324 до 1,8*10^308, число значащих цифр от 15 до 16, размер 8 байт
extended - диапазон от 3,6*10^-4951 до 1,2*10^4932, число значащих цифр от 19 до 20, размер 10 байт
```
В типе single 23 младших байта (0 - 22) хранят значащую часть числа, далее 8 битов (23-30) - порядок, а старший (31) - знак числа.
```c
        [31][30-23][22-0]
знак числа  порядок     значащая часть числа
```
Особенности хранения:

Модуль числа хранится с подвинутой запятой влево, так, чтобы первая цифра была - 1.

Значимая часть хранится скрывая еденицу, которая в целой части должна быть.

Значимая часть вещественного числа хранится в прямом коде.

Значащие части положительного и отрицательных чисел одинаковы, отличаются старшим (знаковым) битом.

Порядок числа - это целое число со знаком, для него используют кодирование со смещением, то есть в целях избавления от знака порядка к нему добавляют положительное смещение. Смещение подбирают так, чтоб число итоговое было всегда положительным. Для типа single это 127(10) = 7F(16) = 111 1111(2). 

Пример числа -12.25:
```c
Двоичное представление целой части: 1100
Двоичное представление дробной части: 01
        1100,01
Для нормализации нужно передвинуть запятую на 3(10) = 11(2) разраяда влево:
        1,10001
Еденица значащая первая скрывается:
        0,10001
Значащий бит самый старший устанаваливается в еденицу, так как число -12,25 отрицательное.
Порядок вещественного числа кодируется со смещением:
        = 11 + 111 1111 = 1000 0010
Собранное число в двоичном виде:
        1 10000010 10001000000000000000000
В шестнадцатеричной системе счисления:
        С1 44 00 00
```

### Сложение и вычитание

Первое что делает процессор перед сложением вещественных чисел - выравнивает их порядки до большего значения. 

Действия процессора (порядок числа p2 со значащей частью z2 меньше порядка p1):

- если порядки p2 = p1 равны, то преобразование закончено

- p2 = p2 + 1

- сдвинуть значащую часть z2 на один разрад вправо

- перейти к начальному шагу

Только когда числа имею одинаковый порядок и их значащие части, они складываются. Затем полный ркзультат нормализуется.

> ВАЖНАЯ Особенность: при выравнивании порядков происходит сдвиг значащей части меньшего из чисел вправо, при этом младшие значащие биты отбрасываются. Это значит что если складывать большое значение с мизерным, то у мизерного разряды исчезнут и большое значение не изменится. Окажется что A + B = A, хотя B не равно 0. Это погрешность компьютерных вычислений.

Пример сложения (все в десятичной системе счисления):
```c
5,5(10) = 101,1 = нормализованная фонма => 1,011 * 2^10
плюс 1,75 = 1,11 = нормализованная фонма => 1,11 * 2^0 = после сдвига => 0,0111 * 2^10
            1,0110
    +       0,0111
            ------
            1,1101
приведение к нормализованной форме => 1,1101 * 2^10 = 111,01 = 7,25(10)
```

### Умножение и деление

Формат чисел с плавающей запятой хорошо подходят для их умножения и деления.

Перемножение - перемножить их значащие части, а порядки сложить.

Деление - значащие части деляться, а порядки вычитаются.

Результат - нормализовать.

Пример перемножения:
```c
1,5(10)=1,1(2) перемножить на 5,0(10)=101,0(2).
Нормализованый вид:
1,1 * 2^0        перемножить на    1,01 * 2^10
Итоговое значение перменоженных значащих частей: 1,1 * 1,11 = 1,111.
Сложение порядков чисел: 0 + 10 = 10.
Результат нормализованный: 1,111 * 2^10. В десятичной системе равен 7,5

```
