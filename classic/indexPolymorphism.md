# Полиморфизм

## Виртуальные методы и их переопределение

Применение процесса переопределения методов позволяет подклассу способ определения собственной версии метода, определенном в его базовом классе. Если базовый класс желает определить метод, который можеты быть переопределен в подклассе, то он должен быть помечен ключевым словом virtual. Такие методы называются виртуальными.

Пример класса с виртуальным методом:
```csharp
public class Person
{
    public int Money { get; set; }
    public virtual void GiveBonus(int num)
    {
        Money += num;
    }
}
```
Пример переопредленеия методов в подклассах:
```csharp
class Manager : Person
{
    public override void GiveBonus(int num)
    {
        Random rnd = new Random();
        Money += num * rnd.Next(2,10); //этот жулик получает больше
    }
}
class Worker : Person
{
    public override void GiveBonus(int num)
    {
        Money += num / 10; //а этот пролетарий получает меньше
    }
}
```
Каждый переопределенный метод может задействовать стандартное поведение посредством ключевого слова base. То есть можно не заменять метод базового класса, а повторно исползовать и расширять стандартное поведение родительского класса.

Пример переопределения методов в подклассах с примененеием ключевого слова base:
```csharp
class Manager : Person
{
    public override void GiveBonus(int num)
    {
        base.GiveBonus(num);
        Money += num * 10; //больше бонусов
    }
}
class Worker : Person
{
    public override void GiveBonus(int num)
    {
        base.GiveBonus(num / 10); //меньше бонусов
    }
}
```
Можно предотвратить переопределение виртуального метода с помощью запечатывания с помощью ключевого слова sealed:
```csharp
class AsiaWorker : Worker
{
    public sealed override void GiveBonus(int num)
    {
        base.GiveBonus(num / 100); //гастарбайтерам еще меньше бонусов
    }
}
```

## Абстрактный класс

Так как базовые классы могут быть довольно расплывчатыми сущностями, то эффективно проектное решение предотвращения возможности непосредственного создания в коде нового объекта этого класса. Это достигается за счет применения абстрактного базового класса с помощью ключевого слова abstract.

Пример базового абстрактного класса:
```csharp
public abstract class Person
{
    public int Money { get; set; }
    public virtual void GiveBonus(int num)
    {
        Money += num;
    }
}
```
Хотя непосредственно создавать экземпляры абстрактноо класса невозможно, они все равно появляются в памяти при создании экземпляров производных классов.

## Полиморфные интерфейсы

Базовый абстрактный класс может определить любое количество абстрактных членов. И каждый наследник должен реализовывать навязанный ему полиморфный интерфейс. Подклассы никода не обязаны переопределять виртуальные методы со стандартной реализацией. 

Для пометки метода как абстрактного в C# используется ключевое слово abstrat. Абстрактные методы являются чистым протоколом, они определеяют имя, возвращаемый тип и набор параметров. Абстрактные методы не предоставляют никакой реализации:
```csharp
public abstract class Person
{
    public int Money { get; set; } = 0;
    public abstract void GiveBonus(int num);
}
class Manager : Person
{
    public override void GiveBonus(int num)
    {
        Money += num * 10;
    }
}
class Worker : Person
{
    public override void GiveBonus(int num)
    {
        Money += num / 10;
    }
}
```
> Абстрактные методы могут быть определены только в абстрактных классах.

Пример полиморфизма на основании этих классов:
```csharp
Person[] myPersons = {new Manager(), new Worker(), new AsiaWorker()};
foreach (var el in myPersons)
{
    el.GiveBonus(10);
    WriteLine(el.Money); // 100 1 0
}
```
>Благодаря полиморфному интерфейсу можно просто и безопасно расширять текущую иерархию. Можно добавлять дополнительные классы производные. Благодаря молиморфному интерфейсу код использующий базовый класса не потребует никаких изменений, так как компилятор обеспечивает использование только совместимых с Person типов.

![Полиморфизм](../img/polymorphism.png) 




