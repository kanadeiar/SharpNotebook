# Entity Framework

В версии .NET 3.5 SP1 был добавлен компонент API-интерфейса ADO.NET под названием Entity Framework (EF). Цель компонента этого - дать возможность взаимодействия с данными из реляционных баз данных в виде объектной модели, отображаемой прямо на бизнес-объекты в приложении. Оперировать коллекцией строго типизированных объектов, называемых сущностями (entity). 

Инфраструктура EF сокращает разрыв между целями и оптимизацией базы данных и целями и оптимизацией объектно-ориентированного программирования. С помощью EF можно работать с базами данных, не сталкиваясь со строками кода SQL. Выполняемая среда EF самостоятельно генерирует подходящие операторы SQL.

Доступность инфраструктур объектно-реляционного отображения  в .NET значительно улучшила ситуацию с доступом к данным, управляя вместо разработчика большинством задач создания, чтения, обновления и удаления (create, read, update, delete — CRUD). Разработчик создает отображение между объектами .NET и реляционной базой данных, а инфраструктура ORM управляет подключениями, генерацией запросов, отслеживанием изменений и хранением данных.

Сущности являются классами, которые отображаются на таблицы базы данных. Специализированный тип коллекции содержит одну или большее количество сущностей. Механизм отслеживания изменений следит за состоянием объектов и любыми связанными с ними изменениями, добавлениями и/или удалениями, а центральная конструкция управляет операциями как руководитель.

## Составные части EF

Строго типизированные классы называемые сущностями - модули физической базы данных, отображаемые на предметную область. Формально - модель сущностных данных (Entity Data Model - EDM). Сущности не обязаны напрямую отображаться на схуму базы данных, обычто так не бывает. Сущностные классы делаются для удовлетворения нужно приложения, затем отображаются на имеющеюся базу данных.

За кулисами работы с EF инфраструктура создает и открывает подключение к базе данных, генерируется и выполняется подходящий оператор SQL, подключение освобождается и закрывается. Обрабатывается без участия человека.

Инфраструктура и ядро EF при работе использует ADO.NET. Требуется поставщик данных, поддерживающий эту инфраструктуру. Например System.Data.Entity для Microsoft SQL Server. 

Класс DbContext используется для запрашивания базы данных и объединения изменений, записивыемых обратно в базу данных в виде одинойной еденицы работы. Класс предоставляет дочерним службы для сохранения изменений, настройку строки подключения, удаление объектов, вызов хранимых процедур и прочее.

## Парадигма Code First

Класс DbContext предоставляет основную функциональность во время работы со средством CodeFirst инфраструктуры EF. Это не означает невозможность примеения EF с существующей базой данных. Можно как использовать Code First с существующей базой данных или создать новую базу данных на основе сущностей с помощью миграций EF.

## Производный контекстный класс

Пример производного класса от DbContext специфичной предметной области, с переданной строкой подключения:

```csharp
public class SampleEntities : DbContext
{
    public SampleEntities() : base("name = SampleConnection")
    { }
    protected override void Dispose(bool disposing)
    { }
}
```







